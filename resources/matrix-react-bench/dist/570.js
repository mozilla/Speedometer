"use strict";(globalThis.webpackChunkmatrix_shell_bench=globalThis.webpackChunkmatrix_shell_bench||[]).push([[570],{49570:(e,t,n)=>{n.r(t),n.d(t,{default:()=>C});var o=n(35466),s=n(74879),a=n(78005),r=n(40168),l=n(94456),i=n(93278),c=n(18911),u=n(6197),m=n(40686),h=n(45960),g=n(74588);function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class C extends o.Component{constructor(e){super(e),d(this,"updateCurrentRoom",(async e=>{const t=c.Z.get();let n;try{n=await t.getStats()}catch{return}let o=null;e&&(o=e.name);const s=t.crawlingRooms(),a=s.crawlingRooms.size,r=s.totalRooms.size;this.setState({eventIndexSize:n.size,eventCount:n.eventCount,crawlingRoomsCount:a,roomCount:r,currentRoom:o})})),d(this,"onDisable",(async()=>{const e=(await n.e(797).then(n.bind(n,85797))).default;l.Z.createTrackedDialog("Disable message search","Disable message search",e,null,null,!1,!0)})),d(this,"onCrawlerSleepTimeChange",(e=>{this.setState({crawlerSleepTime:e.target.value}),r.C.setValue("crawlerSleepTime",null,u.R.DEVICE,e.target.value)})),this.state={eventIndexSize:0,eventCount:0,crawlingRoomsCount:0,roomCount:0,currentRoom:null,crawlerSleepTime:r.C.getValueAt(u.R.DEVICE,"crawlerSleepTime")}}componentWillUnmount(){const e=c.Z.get();null!==e&&e.removeListener("changedCheckpoint",this.updateCurrentRoom)}async componentDidMount(){let e=0,t=0,n=0,o=0,s=null;const a=c.Z.get();if(null!==a){a.on("changedCheckpoint",this.updateCurrentRoom);try{const t=await a.getStats();e=t.size,o=t.eventCount}catch{}const r=a.crawlingRooms();t=r.crawlingRooms.size,n=r.totalRooms.size;const l=a.currentRoom();l&&(s=l.name)}this.setState({eventIndexSize:e,eventCount:o,crawlingRoomsCount:t,roomCount:n,currentRoom:s})}render(){const e=a.Z.get().brand;let t;t=null===this.state.currentRoom?(0,s._t)("Not currently indexing messages for any room."):(0,s._t)("Currently indexing: %(currentRoom)s",{currentRoom:this.state.currentRoom});const n=Math.max(0,this.state.roomCount-this.state.crawlingRoomsCount),r=o.createElement("div",null,(0,s._t)("%(brand)s is securely caching encrypted messages locally for them to appear in search results:",{brand:e}),o.createElement("div",{className:"mx_SettingsTab_subsectionText"},t,o.createElement("br",null),(0,s._t)("Space used:")," ",(0,i.td)(this.state.eventIndexSize,0),o.createElement("br",null),(0,s._t)("Indexed messages:")," ",(0,i.O1)(this.state.eventCount),o.createElement("br",null),(0,s._t)("Indexed rooms:")," ",(0,s._t)("%(doneRooms)s out of %(totalRooms)s",{doneRooms:(0,i.O1)(n),totalRooms:(0,i.O1)(this.state.roomCount)})," ",o.createElement("br",null),o.createElement(m.Z,{label:(0,s._t)("Message downloading sleep time(ms)"),type:"number",value:this.state.crawlerSleepTime.toString(),onChange:this.onCrawlerSleepTimeChange})));return o.createElement(h.Z,{className:"mx_ManageEventIndexDialog",onFinished:this.props.onFinished,title:(0,s._t)("Message search")},r,o.createElement(g.Z,{primaryButton:(0,s._t)("Done"),onPrimaryButtonClick:this.props.onFinished,primaryButtonClass:"primary",cancelButton:(0,s._t)("Disable"),onCancel:this.onDisable,cancelButtonClass:"danger"}))}}}}]);
//# sourceMappingURL=570.js.map